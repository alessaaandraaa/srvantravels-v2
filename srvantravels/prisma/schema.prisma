generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model custom_itinerary {
  custom_ID           Int               @id @default(autoincrement())
  is_made_by_customer Int?
  itinerary           itinerary         @relation(fields: [custom_ID], references: [itinerary_ID], onUpdate: Restrict, map: "custom_itinerary_ibfk_1")
  person              person?           @relation(fields: [is_made_by_customer], references: [person_ID], onDelete: Restrict, onUpdate: Restrict, map: "custom_itinerary_ibfk_2")
  itinerary_stops     itinerary_stops[]

  @@index([is_made_by_customer], map: "is_made_by_customer")
}

model customer {
  customer_ID       Int
  payment_ID        Int
  number_of_PAX     Int?
  date_of_travel    DateTime?       @db.Date
  number_of_luggage Int?
  ID_Picture        Bytes?          @db.Blob
  person            person          @relation(fields: [customer_ID], references: [person_ID], onUpdate: Restrict, map: "customer_ibfk_1")
  payment           payment         @relation(fields: [payment_ID], references: [payment_ID], onUpdate: Restrict, map: "customer_ibfk_2")
  order_details     order_details[]
  van               van[]

  @@id([customer_ID, payment_ID])
  @@index([payment_ID], map: "payment_ID")
}

model driver {
  driver_ID     Int             @id
  plate_number  String?         @db.VarChar(20)
  Availability  Boolean?        @default(false)
  employee      employee        @relation(fields: [driver_ID], references: [employee_ID], onUpdate: Restrict, map: "driver_ibfk_1")
  order_details order_details[]
  van           van[]
}

model employee {
  employee_ID Int      @id
  driver      driver?
  person      person   @relation(fields: [employee_ID], references: [person_ID], onUpdate: Restrict, map: "employee_ibfk_1")
  manager     manager?
}

model itinerary {
  itinerary_ID      Int                @id @default(autoincrement())
  price             Decimal?           @db.Decimal(10, 2)
  type              itinerary_type
  custom_itinerary  custom_itinerary?
  order_details     order_details[]
  package_itinerary package_itinerary?
}

model itinerary_stops {
  stop_ID          Int               @id @default(autoincrement())
  custom_ID        Int?
  stop_order       Int?
  location_ID      Int?
  custom_itinerary custom_itinerary? @relation(fields: [custom_ID], references: [custom_ID], onDelete: Restrict, onUpdate: Restrict, map: "itinerary_stops_ibfk_1")
  locations        locations?        @relation(fields: [location_ID], references: [location_ID], onDelete: Restrict, onUpdate: Restrict, map: "itinerary_stops_ibfk_2")

  @@index([custom_ID], map: "custom_ID")
  @@index([location_ID], map: "location_ID")
}

model locations {
  location_ID      Int               @id @default(autoincrement())
  location_name    String?           @db.VarChar(255)
  location_address String?           @db.VarChar(255)
  is_custom_made   Boolean?          @default(false)
  itinerary_stops  itinerary_stops[]
}

model manager {
  manager_ID        Int                 @id
  employee          employee            @relation(fields: [manager_ID], references: [employee_ID], onUpdate: Restrict, map: "manager_ibfk_1")
  package_itinerary package_itinerary[]
}

model order_details {
  order_ID            Int                   @id @default(autoincrement())
  customer_ID         Int?
  payment_ID          Int?
  driver_ID           Int?
  itinerary_ID        Int?
  number_of_PAX       Int?
  date_of_travel      DateTime?             @db.Date
  time_for_pickup     DateTime?             @db.Time(0)
  time_for_dropoff    DateTime?             @db.Time(0)
  date_of_transaction DateTime?             @default(dbgenerated("(curdate())")) @db.Date
  status              order_details_status? @default(PENDING)
  customer            customer?             @relation(fields: [customer_ID, payment_ID], references: [customer_ID, payment_ID], onDelete: Restrict, onUpdate: Restrict, map: "order_details_ibfk_1")
  driver              driver?               @relation(fields: [driver_ID], references: [driver_ID], onDelete: Restrict, onUpdate: Restrict, map: "order_details_ibfk_2")
  itinerary           itinerary?            @relation(fields: [itinerary_ID], references: [itinerary_ID], onDelete: Restrict, onUpdate: Restrict, map: "order_details_ibfk_3")

  @@index([customer_ID, payment_ID], map: "customer_ID")
  @@index([driver_ID], map: "driver_ID")
  @@index([itinerary_ID], map: "itinerary_ID")
}

model package_itinerary {
  package_ID         Int       @id @default(autoincrement())
  package_name       String?   @db.VarChar(255)
  inclusions         String?   @db.VarChar(1024)
  number_of_PAX      Int?
  route              String?   @db.VarChar(1024)
  description        String?   @db.VarChar(1024)
  is_made_by_manager Int?
  is_available       Boolean?  @default(false)
  package_picture    String?   @db.VarChar(255)
  itinerary          itinerary @relation(fields: [package_ID], references: [itinerary_ID], onUpdate: Restrict, map: "package_itinerary_ibfk_1")
  manager            manager?  @relation(fields: [is_made_by_manager], references: [manager_ID], onDelete: Restrict, onUpdate: Restrict, map: "package_itinerary_ibfk_2")

  @@index([is_made_by_manager], map: "is_made_by_manager")
}

model payment {
  payment_ID     Int                    @id @default(autoincrement())
  payment_method payment_payment_method
  down_payment   Decimal?               @db.Decimal(10, 2)
  payment_status payment_payment_status
  customer       customer[]
}

model person {
  person_ID        Int                @id @default(autoincrement())
  name             String?            @db.VarChar(255)
  password         String?            @db.VarChar(255)
  email            String?            @unique(map: "email") @db.VarChar(255)
  contact_number   String?            @unique(map: "contact_number") @db.VarChar(12)
  custom_itinerary custom_itinerary[]
  customer         customer[]
  employee         employee?
}

model van {
  plate_number       String    @id @db.VarChar(20)
  driver_ID          Int?
  customer_ID        Int?
  payment_ID         Int?
  passenger_capacity Int?
  driver             driver?   @relation(fields: [driver_ID], references: [driver_ID], onDelete: Restrict, onUpdate: Restrict, map: "van_ibfk_1")
  customer           customer? @relation(fields: [customer_ID, payment_ID], references: [customer_ID, payment_ID], onDelete: Restrict, onUpdate: Restrict, map: "van_ibfk_2")

  @@index([customer_ID, payment_ID], map: "customer_ID")
  @@index([driver_ID], map: "driver_ID")
}

enum payment_payment_method {
  CASH
  GCASH
}

enum itinerary_type {
  PACKAGE
  CUSTOM
}

enum payment_payment_status {
  FULLY_PAID     @map("FULLY PAID")
  PARTIALLY_PAID @map("PARTIALLY PAID")
  NOT_PAID       @map("NOT PAID")
}

enum order_details_status {
  ACCEPTED
  REJECTED
  IN_MODIFICATION @map("IN MODIFICATION")
  PENDING
}
