generator client {
  provider            = "prisma-client"
  output              = "./generated"
  importFileExtension = "ts"
}

datasource db {
  provider = "mysql"
}

model Custom_Itinerary {
  custom_ID           Int               @id
  is_made_by_customer Int?
  Itinerary           Itinerary         @relation(fields: [custom_ID], references: [itinerary_ID], onUpdate: Restrict, map: "Custom_Itinerary_ibfk_1")
  Person              Person?           @relation(fields: [is_made_by_customer], references: [person_ID], onDelete: Restrict, onUpdate: Restrict, map: "Custom_Itinerary_ibfk_2")
  Itinerary_Stops     Itinerary_Stops[]

  @@index([is_made_by_customer], map: "is_made_by_customer")
  @@map("custom_itinerary")
}

model Customer {
  customer_ID       Int
  payment_ID        Int
  number_of_PAX     Int?
  date_of_travel    DateTime?       @db.Date
  number_of_luggage Int?
  ID_Picture        String?         @db.VarChar(255)
  person            Person          @relation(fields: [customer_ID], references: [person_ID], onUpdate: Restrict, map: "customer_ibfk_1")
  payment           Payment         @relation(fields: [payment_ID], references: [payment_ID], onUpdate: Restrict, map: "customer_ibfk_2")
  order_details     Order_Details[]
  van               Van[]

  @@id([customer_ID, payment_ID])
  @@index([payment_ID], map: "payment_ID")
  @@map("customer")
}

model Driver {
  driver_ID     Int             @id
  plate_number  String?         @db.VarChar(20)
  Availability  Boolean?        @default(false)
  employee      Employee        @relation(fields: [driver_ID], references: [employee_ID], onUpdate: Restrict, map: "driver_ibfk_1")
  order_details Order_Details[]
  van           Van[]

  @@map("driver")
}

model Employee {
  employee_ID Int      @id
  driver      Driver?
  person      Person   @relation(fields: [employee_ID], references: [person_ID], onUpdate: Restrict, map: "employee_ibfk_1")
  manager     Manager?

  @@map("employee")
}

model Itinerary {
  itinerary_ID      Int                @id @default(autoincrement())
  price             Decimal?           @db.Decimal(10, 2)
  type              itinerary_type
  custom_itinerary  Custom_Itinerary?
  order_details     Order_Details[]
  package_itinerary Package_Itinerary?

  @@map("itinerary")
}

model Itinerary_Stops {
  stop_ID          Int               @id @default(autoincrement())
  custom_ID        Int?
  stop_order       Int?
  location_ID      Int?
  custom_itinerary Custom_Itinerary? @relation(fields: [custom_ID], references: [custom_ID], onDelete: Restrict, onUpdate: Restrict, map: "itinerary_stops_ibfk_1")
  locations        Locations?        @relation(fields: [location_ID], references: [location_ID], onDelete: Restrict, onUpdate: Restrict, map: "itinerary_stops_ibfk_2")

  @@index([custom_ID], map: "custom_ID")
  @@index([location_ID], map: "location_ID")
  @@map("itinerary_stops")
}

model Locations {
  location_ID      Int               @id @default(autoincrement())
  location_name    String?           @db.VarChar(255)
  location_address String?           @db.VarChar(255)
  lng              Float             @db.Float
  lat              Float             @db.Float
  is_custom_made   Boolean?          @default(false)
  itinerary_stops  Itinerary_Stops[]

  @@map("locations")
}

model Manager {
  manager_ID        Int                 @id
  employee          Employee            @relation(fields: [manager_ID], references: [employee_ID], onUpdate: Restrict, map: "manager_ibfk_1")
  package_itinerary Package_Itinerary[]

  @@map("manager")
}

<<<<<<< HEAD
=======
model Message {
  message_ID Int @id @default(autoincrement())

  sender_ID   Int // The Customer (or Admin replying)
  receiver_ID Int? // NULL = Sent to All Admins. SET = Sent to specific User.

  order_ID       Int? // Optional: Context for Cancellations/Rebookings
  requested_date DateTime? @db.Date // Optional: Only used for Rebooking requests

  subject String?  @db.VarChar(255)
  content String   @db.Text
  sent_at DateTime @default(now())

  type message_type @default(GENERAL_INQUIRY)

  // Relations
  sender   Person         @relation("SentMessages", fields: [sender_ID], references: [person_ID], onDelete: Cascade)
  receiver Person?        @relation("ReceivedMessages", fields: [receiver_ID], references: [person_ID], onDelete: SetNull)
  order    Order_Details? @relation(fields: [order_ID], references: [order_ID], onDelete: SetNull)

  @@index([sender_ID])
  @@index([receiver_ID])
  @@index([order_ID])
  @@map("message")
}

>>>>>>> 27a28f71e9a58138f1076198d24d5fc5571d7e31
model Order_Details {
  order_ID            Int                   @id @default(autoincrement())
  customer_ID         Int?
  payment_ID          Int?
  driver_ID           Int?
  itinerary_ID        Int?
  number_of_PAX       Int?
  date_of_travel      DateTime?             @db.Date
  time_for_pickup     DateTime?             @db.Time(0)
  time_for_dropoff    DateTime?             @db.Time(0)
  date_of_transaction DateTime?             @default(dbgenerated("(curdate())")) @db.Date
  status              order_details_status? @default(PENDING)
  message             message[]
  customer            Customer?             @relation(fields: [customer_ID, payment_ID], references: [customer_ID, payment_ID], onDelete: Restrict, onUpdate: Restrict, map: "order_details_ibfk_1")
  driver              Driver?               @relation(fields: [driver_ID], references: [driver_ID], onDelete: Restrict, onUpdate: Restrict, map: "order_details_ibfk_2")
  itinerary           Itinerary?            @relation(fields: [itinerary_ID], references: [itinerary_ID], onDelete: Restrict, onUpdate: Restrict, map: "order_details_ibfk_3")

  messages Message[]

  @@index([customer_ID, payment_ID], map: "customer_ID")
  @@index([driver_ID], map: "driver_ID")
  @@index([itinerary_ID], map: "itinerary_ID")
  @@map("order_details")
}

model Package_Itinerary {
  package_ID            Int                     @id @default(autoincrement())
  package_name          String?                 @db.VarChar(255)
  inclusions            String?                 @db.VarChar(1024)
  number_of_PAX         Int?
  route                 String?                 @db.VarChar(1024)
  description           String?                 @db.VarChar(1024)
  is_made_by_manager    Int?
  is_available          Boolean?                @default(false)
  package_picture       String?                 @db.VarChar(255)
  itinerary             Itinerary               @relation(fields: [package_ID], references: [itinerary_ID], onUpdate: Restrict, map: "package_itinerary_ibfk_1")
  manager               Manager?                @relation(fields: [is_made_by_manager], references: [manager_ID], onDelete: Restrict, onUpdate: Restrict, map: "package_itinerary_ibfk_2")
  package_itinerary_tag package_itinerary_tag[]

  @@index([is_made_by_manager], map: "is_made_by_manager")
  @@map("package_itinerary")
}

model Payment {
  payment_ID     Int                    @id @default(autoincrement())
  payment_method payment_payment_method
  down_payment   Decimal?               @db.Decimal(10, 2)
  payment_status Payment_payment_status
  customer       Customer[]


  @@map("payment")
}

model Person {
  person_ID                           Int                @id @default(autoincrement())
  name                                String?            @db.VarChar(255)
  password                            String?            @db.VarChar(255)
  email                               String?            @unique(map: "email") @db.VarChar(255)
  contact_number                      String?            @unique(map: "contact_number") @db.VarChar(12)
  custom_itinerary                    Custom_Itinerary[]
  customer                            Customer[]
  employee                            Employee?
  message_message_receiver_IDToperson message[]          @relation("message_receiver_IDToperson")
  message_message_sender_IDToperson   message[]          @relation("message_sender_IDToperson")

  sent_messages     Message[] @relation("SentMessages")
  received_messages Message[] @relation("ReceivedMessages")

  @@map("person")
}

model Van {
  plate_number       String    @id @db.VarChar(20)
  driver_ID          Int?
  customer_ID        Int?
  payment_ID         Int?
  passenger_capacity Int?
  driver             Driver?   @relation(fields: [driver_ID], references: [driver_ID], onDelete: Restrict, onUpdate: Restrict, map: "van_ibfk_1")
  customer           Customer? @relation(fields: [customer_ID, payment_ID], references: [customer_ID, payment_ID], onDelete: Restrict, onUpdate: Restrict, map: "van_ibfk_2")

  @@index([customer_ID, payment_ID], map: "customer_ID")
  @@index([driver_ID], map: "driver_ID")
  @@map("van")
}

model tag {
  tag_ID                Int                     @id @default(autoincrement())
  name                  String                  @unique @db.VarChar(255)
  color                 String                  @db.VarChar(255)
  package_itinerary_tag package_itinerary_tag[]
}

model package_itinerary_tag {
  package_ID               Int
  tag_ID                   Int
  package_itinerary_tag_ID Int               @id @default(autoincrement())
  package_itinerary        Package_Itinerary @relation(fields: [package_ID], references: [package_ID])
  tag                      tag               @relation(fields: [tag_ID], references: [tag_ID])

  @@unique([package_ID, tag_ID])
  @@index([package_ID])
  @@index([tag_ID])
}

model message {
  message_ID                         Int            @id @default(autoincrement())
  sender_ID                          Int
  receiver_ID                        Int?
  order_ID                           Int?
  requested_date                     DateTime?      @db.Date
  subject                            String?        @db.VarChar(255)
  content                            String         @db.Text
  sent_at                            DateTime       @default(now())
  type                               message_type   @default(GENERAL_INQUIRY)
  order_details                      Order_Details? @relation(fields: [order_ID], references: [order_ID])
  person_message_receiver_IDToperson Person?        @relation("message_receiver_IDToperson", fields: [receiver_ID], references: [person_ID])
  person_message_sender_IDToperson   Person         @relation("message_sender_IDToperson", fields: [sender_ID], references: [person_ID], onDelete: Cascade)

  @@index([order_ID])
  @@index([receiver_ID])
  @@index([sender_ID])
}

enum itinerary_type {
  PACKAGE
  CUSTOM
}

enum Payment_payment_status {
  FULLY_PAID     @map("FULLY PAID")
  PARTIALLY_PAID @map("PARTIALLY PAID")
  NOT_PAID       @map("NOT PAID")
}

enum order_details_status {
  ACCEPTED
  REJECTED
  IN_MODIFICATION @map("IN MODIFICATION")
  PENDING
}

enum payment_payment_method {
  CASH
  GCASH
  PENDING
}

enum message_type {
  CANCELLATION_REQUEST
  REBOOKING_REQUEST
  GENERAL_INQUIRY
}
